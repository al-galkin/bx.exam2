# [ex2-54] Подсчет количества зарегистрированных пользователей

*Подробное описание задачи смотреть в материалах: [примеры заданий (pdf)](../pubinfo/Ex2AllType.pdf)*

## Решаемая задача 

* Создать функцию, которая будет подсчитывать, сколько новых пользователей зарегистрировано на сайте с момента прошлого подсчета и отправлять письмо всем пользователям из группы «Администраторы».

* Текст письма: «на сайте зарегистрировано [count] пользователей за [days]». Где count – количество зарегистрированных пользователей, days – за какое количество дней произведен подсчет.

* Шаблон текста письма должен быть доступен для редактирования администратору сайта.

* Функцию необходимо реализовать, используя технологию агентов, она должна запускаться 1 раз каждый день, в 01:00.

* Дату подсчета сохранять и получать с помощью параметров модулей.

* Почтовый сервер складывает письма в папку /home/bitrix/mail, можно проверить решение.

* Функцию назвать CheckUserCount, агента – Подсчет пользователей.

## Решение

* Создаём почтовое событие и шаблон

* Создаем функцию CheckUserCount(), подключаем через init.php
    * Описание логики внутри функции
    
* Создаем агента для вызова данной функции с параметрами:
    * Дата и время следующего запуска: 10.12.2019 01:00:00
    * Функция агента: CheckUserCount();
    * Периодичность выполнения: через заданный интервал
    * Интервал (сек.): 86400 (24 часа)

## P.S.

* Иван Малышин "не будет никого на сайте и ок, cron не используем в этом задании"
    * [Экзамен №2. Вопросы и ответы по заданиям](https://dev.1c-bitrix.ru/support/forum/forum6/topic91539/?PAGEN_1=2)
* Иван Малышин "Нет хитов, ну значит не отработает. В рамках экзамена с выносом на крон - не заморачиваемся."
    * [Экзамен №2. Вопросы и ответы по заданиям](https://dev.1c-bitrix.ru/community/forums/forum6/topic91539/?PAGEN_1=8)

## Полезные ссылки

* [ConvertTimeStamp](https://dev.1c-bitrix.ru/api_help/main/functions/date/converttimestamp.php)
* [COption::GetOptionString](https://dev.1c-bitrix.ru/api_help/main/reference/coption/getoptionstring.php)
* [COption::SetOptionString](https://dev.1c-bitrix.ru/api_help/main/reference/coption/setoptionstring.php)
* [CUser::GetList](https://dev.1c-bitrix.ru/api_help/main/reference/cuser/getlist.php)
* [CEvent::Send](https://dev.1c-bitrix.ru/api_help/main/reference/cevent/send.php)

____
* [Задания](tasks.md)
* [README.md](../../README.md)